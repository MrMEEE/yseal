# ySEal Quick Reference

## ðŸš€ Getting Started (SQLite - No PostgreSQL Required!)

```bash
# Clone and setup
git clone https://github.com/MrMEEE/yseal.git
cd yseal
./setup_sqlite.sh

# Start developing
source venv/bin/activate
python manage.py runserver
```

**That's it!** Open http://localhost:8000/admin/ and login with:
- Username: `admin`
- Password: `admin`

---

## ðŸ“‹ Common Commands

### Development Server
```bash
python manage.py runserver              # Start server
python manage.py runserver 0.0.0.0:8000  # Accessible from network
```

### Database
```bash
python manage.py makemigrations         # Create migrations
python manage.py migrate                # Apply migrations
python manage.py dbshell                # Database shell
rm db.sqlite3 && python manage.py migrate  # Reset database
```

### Users
```bash
python manage.py createsuperuser        # Create admin user
python manage.py changepassword admin   # Change password
```

### Testing
```bash
pytest                                  # Run all tests
pytest --cov                           # With coverage
pytest -n auto                         # Parallel
pytest apps/policies/                  # Specific app
```

### Shell
```bash
python manage.py shell                 # Django shell
python manage.py shell_plus            # Enhanced shell (django-extensions)
```

---

## ðŸ—„ï¸ Database Toggle

### Currently Using: SQLite âœ…

**Switch to PostgreSQL:**
```bash
# 1. Edit .env
echo "USE_POSTGRES=True" >> .env

# 2. Create PostgreSQL database
createdb yseal
createuser yseal -P

# 3. Migrate
python manage.py migrate
```

**Switch back to SQLite:**
```bash
# Edit .env
echo "USE_POSTGRES=False" > .env

# Migrate
python manage.py migrate
```

---

## ðŸ”— API Endpoints

### Pages
- Home: http://localhost:8000/
- Admin: http://localhost:8000/admin/
- API Docs (Swagger): http://localhost:8000/api/docs/
- API Schema (OpenAPI): http://localhost:8000/api/schema/

### Authentication
- `POST /api/auth/register/` - Register new user
- `POST /api/auth/login/` - Get auth token
- `POST /api/auth/logout/` - Logout
- `GET /api/auth/profile/` - User profile

### API v3 (CLI)
- `GET /api/v3/namespaces/` - List namespaces
- `GET /api/v3/policies/` - List policies
- `GET /api/v3/search/` - Search policies

### API v1 (UI)
- `GET /api/_ui/v1/` - UI-specific endpoints

---

## ðŸ§ª Testing Quick Reference

### Run Specific Tests
```bash
# Test a model
pytest apps/policies/tests/test_models.py::TestPolicy

# Test a view
pytest apps/policies/tests/test_views.py::test_policy_list

# With output
pytest -s

# Stop on first failure
pytest -x
```

### Coverage
```bash
# Generate HTML coverage report
pytest --cov --cov-report=html

# View report
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

---

## ðŸ“¦ Models Overview

### User & Auth
- `User` - Custom user model
- `UserProfile` - Extended user data

### Namespaces
- `Namespace` - Policy organization
- `NamespaceLink` - External links

### Policies
- `Policy` - Main policy
- `PolicyVersion` - Versioned releases
- `PolicyFile` - Individual files
- `Tag` - Categorization
- `DownloadLog` - Analytics

### Community
- `Vote` - Upvote/downvote
- `Rating` - 5-star ratings
- `RatingHelpfulness` - Rating votes

---

## ðŸ”§ Environment Variables

```bash
# Django
DJANGO_SECRET_KEY=<auto-generated>
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Database
USE_POSTGRES=False  # Set True for PostgreSQL

# Optional (for PostgreSQL)
DB_NAME=yseal
DB_USER=yseal
DB_PASSWORD=yseal
DB_HOST=localhost
DB_PORT=5432
```

---

## ðŸ› Debugging

### Django Debug Toolbar
Automatically enabled when `DEBUG=True`. Shows:
- SQL queries
- Templates used
- Cache hits/misses
- Request/response data

### Python Debugger
```python
# Add to any view/function
import pdb; pdb.set_trace()
```

### Check Errors
```bash
python manage.py check
python manage.py check --deploy  # Production checks
```

---

## ðŸ“ Creating New Models

1. **Edit model**:
   ```python
   # apps/myapp/models.py
   class MyModel(TimeStampedModel):
       name = models.CharField(max_length=100)
   ```

2. **Create migration**:
   ```bash
   python manage.py makemigrations
   ```

3. **Apply migration**:
   ```bash
   python manage.py migrate
   ```

4. **Register in admin**:
   ```python
   # apps/myapp/admin.py
   @admin.register(MyModel)
   class MyModelAdmin(admin.ModelAdmin):
       list_display = ['name', 'created_at']
   ```

---

## ðŸŽ¨ Static Files

### Development
```bash
# Collect static files
python manage.py collectstatic

# Find static files
python manage.py findstatic debug_toolbar/js/toolbar.js
```

---

## ðŸ” Search Feature (PostgreSQL Only)

When `USE_POSTGRES=True`, full-text search is available:

```python
# Search policies
from apps.policies.models import Policy
Policy.objects.filter(search_vector='selinux httpd')
```

With SQLite, use standard queries:
```python
Policy.objects.filter(name__icontains='httpd')
```

---

## ðŸš¢ Deployment Checklist

- [ ] Set `DEBUG=False`
- [ ] Generate new `DJANGO_SECRET_KEY`
- [ ] Set `USE_POSTGRES=True`
- [ ] Configure PostgreSQL
- [ ] Set up Redis for Celery
- [ ] Configure `ALLOWED_HOSTS`
- [ ] Set up static file serving
- [ ] Configure email backend
- [ ] Enable HTTPS
- [ ] Set up logging
- [ ] Configure Celery workers
- [ ] Set up monitoring

---

## ðŸ“š Resources

### Documentation
- Django: https://docs.djangoproject.com/
- DRF: https://www.django-rest-framework.org/
- Celery: https://docs.celeryproject.org/

### Project Docs
- `README.md` - Full documentation
- `SQLITE_SETUP.md` - SQLite configuration details
- `PROJECT_SUMMARY.md` - Project overview
- `API_DOCS.md` - API reference (to be created)

---

## ðŸ’¡ Tips & Tricks

### Quick Database Reset
```bash
rm db.sqlite3 && python manage.py migrate && python manage.py createsuperuser --username admin --email admin@yseal.local --noinput
```

### Create Sample Data
```bash
python manage.py shell
>>> from apps.policies.tests.factories import PolicyFactory
>>> PolicyFactory.create_batch(10)
```

### View SQL Queries
```python
from django.db import connection
print(connection.queries)
```

### Django Shell with IPython
```bash
python manage.py shell  # Uses IPython if installed
```

---

**Last Updated**: December 1, 2025  
**Database**: SQLite (development) / PostgreSQL (production)
